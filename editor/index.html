<html>
<head>
    <title>Project Catapult</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.1/css/bulma.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.3/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.9/ace.js"></script>
    <script src="https://unpkg.com/deeplearn"></script>
    <style>
        body {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }

        #viewer, #editor {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }
    </style>
</head>
<body>
    <button style="position:absolute;top:5px;right:5px;z-index:5;" class="button is-primary" onclick="run()">Run</button>
    <button style="position:absolute;bottom:5px;right:5px;z-index:5;" class="button is-danger" onclick="reset()">Reset</button>

    <div id="editor">/**
 * Welcome to the Catapult editor! You can try out simple pieces of deeplearnjs code
 * here and get instant feedback. Your code is saved locally - feel free to close
 * this tab and come back later, just don't clear your cache!
 * 
 * The below example shows how to set up a deeplearnjs graph and use it to perform
 * inference with a simple linear regression model. Click the `Run` button on the 
 * top right and the results should appear in your console.
 */

// construct a new graph
const graph = new deeplearn.Graph();

// add a placeholder...
const x = graph.placeholder('x', []);

// add a few variables...
const w = graph.variable('w', deeplearn.Scalar.new(Math.random()));
const b = graph.variable('b', deeplearn.Scalar.new(Math.random()));

// y = w*x + b
const y = graph.add(graph.multiply(w, x), b);

// create a new math object and a session
const math = new deeplearn.NDArrayMathGPU();
const session = new deeplearn.Session(graph, math);

// compute y, after filling in placeholder x with a scalar value of 4
result = session.eval(y, [{tensor: x, data: deeplearn.Scalar.new(4)}]);

// print the result.
result.data().then(data => console.log(data))

// Next Step: Try modifying this code to do training in addition to inference. You 
// can use the meanSquaredCost loss function.
</div>
    </div>

    <div id="viewer" style="background-color:white;z-index:10">
        <h1 class="title" style="text-align:center;padding-top:10%;">Welcome!</h1>
        <p style="text-align:center;max-width:480px;margin:auto;">
            Right click on the page and click <code>Inspect Element</code>. If you don't
            see <code>Let's get started!</code>, try clicking on the <code>console</code> 
            tab. When you're ready, click the start button to start coding.
        </p>
        <br/>
        <p style="text-align:center;">
            <button class="button is-primary" onclick="start()">Start</button>
        </p>
    </div>

    <script>
        console.log("Let's get started!")

        var editor = ace.edit("editor");
        editor.$blockScrolling = Infinity;
        editor.setTheme("ace/theme/github");
        editor.getSession().setMode("ace/mode/javascript");

        function run() {
            eval(editor.getValue())
        }

        function start() {
            $('#viewer').hide()
            localStorage.setItem("editor.started", true)
        }

        function reset() {
            if (confirm("Are you sure? All data will be lost.")) {
            localStorage.setItem("editor.started", "")
            localStorage.setItem("editor.code", "")
                window.location.reload()
            }
        }

        if (localStorage.getItem("editor.started")) {
            start()
        }

        setInterval(function () {
            localStorage.setItem("editor.code", editor.getValue())
        }, 1000)

        if (localStorage.getItem("editor.code")) {
            editor.setValue(localStorage.getItem("editor.code"))
        }
    </script>
</body>
</html>
